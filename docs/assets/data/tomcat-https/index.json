{"hash":"7e904d8306c50074fbbf331f9cb47fa27247aeb1","data":{"metadata":{"siteName":"블로그 테스트","siteDescription":"간단한 깃허브 블로그 만들어 보기"},"post":{"id":"01c4006e0f47eca0e95e898e09ffbcc7","title":"tomcat https 적용","content":"<h2 id=\"ssl인증서-발급\"><a href=\"#ssl%EC%9D%B8%EC%A6%9D%EC%84%9C-%EB%B0%9C%EA%B8%89\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>SSL인증서 발급</h2>\n<p>개인 인증서를 발급받아서 HTTPS통신을 하고자 한다.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 개인키 생성</span>\nopenssl genrsa -des3 -out server.key <span class=\"token number\">2048</span>\n\n<span class=\"token comment\"># 인증요청서 생성. (자신의 정보 입력)</span>\nopenssl req -new -key server.key -out server.csr\n\n<span class=\"token comment\"># (선택) 개인키에서 패스워드 제거</span>\n<span class=\"token function\">cp</span> server.key server.key.origin\nopenssl rsa -in server.key.origin -out server.key\n\n<span class=\"token comment\"># 인증서 생성</span>\nopenssl x509 -req -days <span class=\"token number\">3650</span> -in server.csr -signkey server.key -out server.crt\n<span class=\"token comment\"># 여기까지 마치면 서버 인증서인 server.crt파일이 생성된다.</span></code></pre>\n<h2 id=\"ssl인증서를-발급받았으면-이제-톰캣에-맞는-형식으로-바꾸어-준다\"><a href=\"#ssl%EC%9D%B8%EC%A6%9D%EC%84%9C%EB%A5%BC-%EB%B0%9C%EA%B8%89%EB%B0%9B%EC%95%98%EC%9C%BC%EB%A9%B4-%EC%9D%B4%EC%A0%9C-%ED%86%B0%EC%BA%A3%EC%97%90-%EB%A7%9E%EB%8A%94-%ED%98%95%EC%8B%9D%EC%9C%BC%EB%A1%9C-%EB%B0%94%EA%BE%B8%EC%96%B4-%EC%A4%80%EB%8B%A4\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>SSl인증서를 발급받았으면 이제 톰캣에 맞는 형식으로 바꾸어 준다</h2>\n<p>server.crt가 준비된 후 실행</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 인증서이름(server.crt), 인증서키이름(server.key)를 톰캣에 맞는 형식으로(.keystore) 바꿔줌.</span>\nopenssl pkcs12 -export -in server.crt -inkey server.key -out .keystore -name tomcat</code></pre>\n<h2 id=\"톰캣-인증서를-생성했으면-serverxml에서-설정해줘야-한다\"><a href=\"#%ED%86%B0%EC%BA%A3-%EC%9D%B8%EC%A6%9D%EC%84%9C%EB%A5%BC-%EC%83%9D%EC%84%B1%ED%96%88%EC%9C%BC%EB%A9%B4-serverxml%EC%97%90%EC%84%9C-%EC%84%A4%EC%A0%95%ED%95%B4%EC%A4%98%EC%95%BC-%ED%95%9C%EB%8B%A4\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>톰캣 인증서를 생성했으면 server.xml에서 설정해줘야 한다</h2>\n<pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Connector</span> <span class=\"token attr-name\">port</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>443<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">protocol</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>org.apache.coyote.http11.Http11NioProtocol<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">maxthreads</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>150<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">sslenabled</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">scheme</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>https<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">secure</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">clientauth</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">sslprotocol</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>TLS<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">keystorepass</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>인증서 비밀번호<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">keystorefile</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>인증서 위치<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></code></pre>\n<h2 id=\"http로-접속-시-https로-자동-리다이렉트-설정\"><a href=\"#http%EB%A1%9C-%EC%A0%91%EC%86%8D-%EC%8B%9C-https%EB%A1%9C-%EC%9E%90%EB%8F%99-%EB%A6%AC%EB%8B%A4%EC%9D%B4%EB%A0%89%ED%8A%B8-%EC%84%A4%EC%A0%95\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>http로 접속 시 https로 자동 리다이렉트 설정</h2>\n<pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token comment\">&lt;!-- web.xml에 이 부분을 넣으면 된다는 데 제대로 되지 않아서 좀 더 알아봐야 겠다. --></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>security-constraint</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>web-resource-collection</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>web-resource-name</span><span class=\"token punctuation\">></span></span>SSL Forward<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>web-resource-name</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>url-pattern</span><span class=\"token punctuation\">></span></span>/*<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>url-pattern</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>web-resource-collection</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>user-data-constraint</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>transport-guarantee</span><span class=\"token punctuation\">></span></span>CONFIDENTIAL<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>transport-guarantee</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>user-data-constraint</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>security-constraint</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>참고 :</p>\n<ul>\n<li><a href=\"https://zetawiki.com/wiki/%EB%A6%AC%EB%88%85%EC%8A%A4_%EC%9E%90%EC%B2%B4%EC%84%9C%EB%AA%85_SSL_%EC%9D%B8%EC%A6%9D%EC%84%9C_%EC%83%9D%EC%84%B1\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://zetawiki.com/wiki/%EB%A6%AC%EB%88%85%EC%8A%A4_%EC%9E%90%EC%B2%B4%EC%84%9C%EB%AA%85_SSL_%EC%9D%B8%EC%A6%9D%EC%84%9C_%EC%83%9D%EC%84%B1</a></li>\n<li><a href=\"https://namjackson.tistory.com/25\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://namjackson.tistory.com/25</a></li>\n<li><a href=\"https://offbyone.tistory.com/262\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://offbyone.tistory.com/262</a></li>\n</ul>\n<p>@TODO 각각의 명령어가 무슨역할을 하는지 알아보자</p>\n<p>@TODO openssl패키지를 이용하여 개인키를 생성했는데 keytool로도 해보자</p>\n<p>@TODO http로 접속 시 https로 리다이렉트 되게 하는 법 알아보기</p>\n","date":"2019년 06월 11일"}},"context":{}}